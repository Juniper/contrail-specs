{
  "comments": [
    {
      "key": {
        "uuid": "b13ac450_bf8d093e",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 232
      },
      "writtenOn": "2020-03-04T05:41:48Z",
      "side": 1,
      "message": "How about the other htables/btables? NH, MPLS, Frag etc.? Now we increased the NH limit to 1Million, so it would require more memory? Would also be good to provide huge memory backing for log buffers (which is in CI).",
      "range": {
        "startLine": 49,
        "startChar": 0,
        "endLine": 49,
        "endChar": 62
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05c33592_f1227915",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 631
      },
      "writtenOn": "2020-03-04T06:22:03Z",
      "side": 1,
      "message": "The NH and MPLS tables store only pointers to the NH. So these tables actually don\u0027t take much memory and existing memory allocation is enough. The individual NHs are allocated individually.\nIn case of flow and bridge tables, the hash tables themselves store the individual entries as well, and hence need more memory - requiring us to allocate them through huge pages.\n\nFor log buffers, since the code is not committed yet, lets take it up as part of that.\nWe need to just call one api to alloc pages using huge pages.",
      "parentUuid": "b13ac450_bf8d093e",
      "range": {
        "startLine": 49,
        "startChar": 0,
        "endLine": 49,
        "endChar": 62
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d2108b5d_5c361071",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 97,
      "author": {
        "id": 437
      },
      "writtenOn": "2020-02-26T12:19:49Z",
      "side": 1,
      "message": "Is it the name of new section in config file?",
      "range": {
        "startLine": 97,
        "startChar": 4,
        "endLine": 97,
        "endChar": 13
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77ad6c54_d2f7a98b",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 97,
      "author": {
        "id": 631
      },
      "writtenOn": "2020-02-28T11:16:54Z",
      "side": 1,
      "message": "No, this section already exists I believe.",
      "parentUuid": "d2108b5d_5c361071",
      "range": {
        "startLine": 97,
        "startChar": 4,
        "endLine": 97,
        "endChar": 13
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d22b3d7d_e7cae439",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 101,
      "author": {
        "id": 437
      },
      "writtenOn": "2020-02-26T12:19:49Z",
      "side": 1,
      "message": "Whats is default? My understanding that default behaviour is \u0027without hugepages\u0027 ?",
      "range": {
        "startLine": 101,
        "startChar": 5,
        "endLine": 101,
        "endChar": 17
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd16d386_efc5fb98",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 101,
      "author": {
        "id": 631
      },
      "writtenOn": "2020-02-28T11:16:54Z",
      "side": 1,
      "message": "Good question. This requires some thought. I think default should be with hugepages so that upgrades can be supported in future.",
      "parentUuid": "d22b3d7d_e7cae439",
      "range": {
        "startLine": 101,
        "startChar": 5,
        "endLine": 101,
        "endChar": 17
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "901b279f_7ee29e59",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 102,
      "author": {
        "id": 437
      },
      "writtenOn": "2020-02-26T12:19:49Z",
      "side": 1,
      "message": "Do I understand it correctly that in case if options for both 1M and 1G pages are set then in agent config have both lines, otherwise one of them?",
      "range": {
        "startLine": 101,
        "startChar": 0,
        "endLine": 102,
        "endChar": 51
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3fa4907_721d5358",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 102,
      "author": {
        "id": 631
      },
      "writtenOn": "2020-02-28T11:16:54Z",
      "side": 1,
      "message": "No. The current plan is we should configure only either 2MB or 1GB pages (not both) in the agent config file. Will update you if any change in this.",
      "parentUuid": "901b279f_7ee29e59",
      "range": {
        "startLine": 101,
        "startChar": 0,
        "endLine": 102,
        "endChar": 51
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b1cde4a3_dbd1ce91",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 131,
      "author": {
        "id": 437
      },
      "writtenOn": "2020-02-26T12:19:49Z",
      "side": 1,
      "message": "Not sure it is provisioning duty to create it.. tlbfs is not a regular FS.. afaik, it is not possible \u0027just create a file\u0027 there..  Is it worth to have agent that allocates pages according to the provided config options  huge_page_1G in  huge_page_2M?  Provisioning can configure OS for HP reservation (according to options and availability of 1M/1G pages) and preparing the config. Then agent will be able allocate pages there which are actually looks like a files under  /dev/hugepages. ?",
      "range": {
        "startLine": 131,
        "startChar": 0,
        "endLine": 131,
        "endChar": 65
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9580055a_91cf1174",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 131,
      "author": {
        "id": 631
      },
      "writtenOn": "2020-02-28T11:16:54Z",
      "side": 1,
      "message": "Yes, it should be possible to do it in agent. Let me check this and get back.",
      "parentUuid": "b1cde4a3_dbd1ce91",
      "range": {
        "startLine": 131,
        "startChar": 0,
        "endLine": 131,
        "endChar": 65
      },
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "84d4285d_f6bc7144",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 137,
      "author": {
        "id": 437
      },
      "writtenOn": "2020-02-26T12:19:49Z",
      "side": 1,
      "message": "It is hardly possible. Deployment process is not an interactive process... there is no way to ask user.  An error might be permanent - then the node be rebooted again and again. Some  orchestrator may not tolerate auto reboot of nodes during deploy, say, they may allow it but after deployment is done (e.g. as a maintenance operation). Some orchestrators just run containers and dont even wait any results (like pure k8s manifests or openshift i suppose) - and it is up to admin to go and check status of contrail.\n\nFrom my view in case of errors agent container be just restarted till error disappear (like it is now).  If reboot is needed to fix error - then it should be covered for each orchestrator individually.\nE.g. in rhosp hugepages options are set in kernel boot time parameters and reboot of the node is done automatically and a bootstrap node step. So no other reboots are needed at later deployemnt steps.",
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fa670e33_ba96ec4d",
        "filename": "ziu_vrouter_huge_pages_support.md",
        "patchSetId": 1
      },
      "lineNbr": 137,
      "author": {
        "id": 631
      },
      "writtenOn": "2020-02-28T11:16:54Z",
      "side": 1,
      "message": "Basically then we need a way to propagate error to the orchestrator. How is it done today? May be we can follow the same. From vrouter/agent side, we will log the error message in contrail-vrouter-agent.log file and dmesg. But deployer/orchestrator needs to know that an error has occurred and act accordingly (either restart the containers/reboot the node).",
      "parentUuid": "84d4285d_f6bc7144",
      "revId": "f571b0c50a2d2d343684b3c8356ed4d604a7171f",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": true
    }
  ]
}